---
layout: post
title: Have you put the chickens to bed?
date: '2013-02-03T17:52:00.001Z'
author: Tom White
tags: 
modified_time: '2013-02-03T17:52:40.915Z'
thumbnail: http://2.bp.blogspot.com/-iTi2rcr5yJI/UQ6anIfdqaI/AAAAAAAAALM/fDHbWAsLzL0/s72-c/chickenalerts.png
blogger_id: tag:blogger.com,1999:blog-8898949683610477251.post-3144519400768005075
blogger_orig_url: http://www.tom-e-white.com/2013/02/have-you-put-chickens-to-bed.html
---

"Have you put the chickens to bed?" -- it's a question we ask each other frequently in our house, since we are the <a href="http://welshchickengirl.blogspot.co.uk/">proud owners</a> of seven beautiful hens. Normally Eliane has, but when Lottie, our younger daughter, asked long after it had got dark one evening last week it turned out that none of us had, despite having <a href="{{ site.baseurl }}{% post_url 2012-12-16-ifttt %}">IFTTT alerts set up to remind us</a>.<br /><br />The problem with the alert is that it is set to go off at sunset, which is all that IFTTT allows, and that's a bit too early as it's not dark enough for the chickens to be in their house. So we wait a bit, then we forget.<br /><br />So I decided to write an Android app to send an alert a fixed amount of time (say 45 minutes) after sunset, so that when we received it, it would be dark, the chickens would be in their house, and we could close the door there and then.<br /><br />This is the result:<br /><div class="separator" style="clear: both; text-align: center;"><a href="{{ site.url }}/assets/2013-02-03-image-0000.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" src="{{ site.url }}/assets/2013-02-03-image-0000.png" height="142" width="320" /></a></div><br />Eliane is currently beta testing it, so we'll see how well it works. (Obviously the long term goal is an automatic sensor to open and close the chicken house door, but we're not there yet.)<br /><br /><h3>Writing Android Apps</h3><div>This is the first Android app I've written, and overall I found the process very straightforward. A couple of years ago I ran a "Hello World" Android tutorial, and I seem to remember most of the time taken to get the app running was installing the Eclipse plugin. This time the Android Developer Tools (ADT) include a customized version of Eclipse, making the getting started process much smoother.&nbsp;</div><div><br /></div><div>The Android API is huge and fairly intimidating. It is, however, incredibly well documented, and the user guides are invaluable. The hardest part of writing the app was figuring out which parts of the API to use - do I need a <span style="font-family: Courier New, Courier, monospace;">BroadcastReceiver</span> or a <span style="font-family: Courier New, Courier, monospace;">Service</span>?, how do <span style="font-family: Courier New, Courier, monospace;">AlarmManager</span> and <span style="font-family: Courier New, Courier, monospace;">Notification</span> interact? - that kind of thing. There's a lot of material online covering how to do various things in Android, and these offered general pointers, but not necessarily useful code, since the API evolves rapidly from release to release. And although the older code is generally supported, since compatibility is taken very seriously, there may be a better way of doing things in later versions.</div><div><br /></div><div>The ADT tooling is good and encourages you to do the right thing - for example, extracting natural language strings from your app so it's easy to change them (or translate them) later. In this case, a class called <span style="font-family: Courier New, Courier, monospace;">R</span>&nbsp;is generated which has references to all the assets that you need in you app: icons, sound files, strings, etc. For example, the audio file which plays when the notification is received is referred to with:</div><div><br /></div><div>       <div class="p1"><span style="font-family: Courier New, Courier, monospace;">R.raw.<span class="s1">cluck</span></span></div><div class="p1"><br /></div><div class="p1">To generate the icons I drew a chicken on a piece of paper with a sharpie, then took a photo of it and used an <a href="http://www.iaza.com/index-ln.html">online image editor</a>&nbsp;to make the background transparent. The <a href="http://android-ui-utils.googlecode.com/hg/asset-studio/dist/index.html">Android Asset Studio</a> completed the job of converting the image to a set of icons. (I didn't use Inkscape in the end, but <a href="http://envyandroid.com/archives/271/easiest-way-to-create-android-icons">this blog entry</a> shows how to convert from an Inkscape drawing.)&nbsp;</div><div class="p1"><br /></div></div><h3>What's Next?</h3><div>The biggest limitation in the app at the moment is that the <a href="https://github.com/mikereedell/sunrisesunsetlib-java">calculation for sunset time</a> is hardcoded for the UK. Using the <a href="http://developer.android.com/guide/topics/location/strategies.html">Location API</a> is the obvious next step there.</div><div><br /></div><div>There are also some complications to do with making sure that notifications will still be sent even the phone is rebooted. I want to make sure that works properly before putting the app on Google Play.</div><div><br /></div><div>The UI is pretty rudimentary too and could do with some work.</div><div><br /></div><div>And before we get to the fully-automated solution, we could have a sensor that detects if the door is open or closed and only sends the reminder if the door hasn't been closed for the night.</div><br />Source is on <a href="https://github.com/tomwhite/chickenalerts">GitHub</a>.<br /><br />